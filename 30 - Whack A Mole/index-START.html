<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Whack A Mole!</title>
    <link
      href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700"
      rel="stylesheet"
      type="text/css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1>Whack-a-mole! <span class="score">0</span></h1>
    <button onClick="startGame()">Start!</button>

    <div class="game">
      <div class="hole">
        <div class="mole"></div>
      </div>
      <div class="hole">
        <div class="mole"></div>
      </div>
      <div class="hole">
        <div class="mole"></div>
      </div>
      <div class="hole">
        <div class="mole"></div>
      </div>
      <div class="hole">
        <div class="mole"></div>
      </div>
      <div class="hole">
        <div class="mole"></div>
      </div>
    </div>

    <script>
      let isPlaying = false;
      let lastHoleIndex;

      function getRandomHole() {
        const holes = document.querySelectorAll('.hole');
        const holeIndex = getRandomNumberBetween(0, holes.length - 1);
        if (lastHoleIndex && lastHoleIndex === holeIndex) {
          return getRandomHole();
        }
        lastHoleIndex = holeIndex;
        return holes[holeIndex];
      }

      function getRandomNumberBetween(max, min) {
        return Math.round(Math.random() * (max - min) + min);
      }

      function handleMoleClick(mouseClickEvent) {
        if (!mouseClickEvent.isTrusted) return; //cheater
        updateScore();
        this.parentElement.classList.remove('up');
      }

      function showMole() {
        const moleDuration = getRandomNumberBetween(200, 1000);
        const hole = getRandomHole();
        hole.classList.add('up');

        setTimeout(() => {
          hole.classList.remove('up');
          if (isPlaying) {
            showMole();
          }
        }, moleDuration);
      }

      function startGame() {
        updateScore(true);
        isPlaying = true;

        setTimeout(() => {
          isPlaying = false;
        }, 10000);

        showMole();
      }

      function updateScore(clearScore = false) {
        const scoreEl = document.querySelector('.score');
        const score = clearScore ? 0 : +scoreEl.textContent + 1;
        scoreEl.textContent = score;
      }

      document
        .querySelectorAll('.mole')
        .forEach(mole => mole.addEventListener('click', handleMoleClick));
    </script>
  </body>
</html>
